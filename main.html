<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nest Link | Premium Real Estate</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Poppins', 'sans-serif'] },
                    colors: {
                        brand: {
                            yellow: '#FFD700',
                            dark: '#111827',
                            verified: '#00BAFF'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .nav-center-container { position: absolute; top: -28px; left: 50%; transform: translateX(-50%); }
        .nav-center-btn {
            width: 60px; height: 60px; background: #FFD700; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 24px; box-shadow: 0 0px 15px rgba(255, 215, 0, 0.4);
            border: 4px solid white;
        }
        .listing-img { transition: transform 0.3s ease; }
        .listing-card:hover .listing-img { transform: scale(1.05); }
        .gallery-dot.active { background-color: #FFD700; width: 20px; }
        #app-root { height: calc(100vh - 80px); }
        
        /* Header Hero Styles */
        .hero-gradient { background: linear-gradient(to bottom, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.7) 100%); }

        /* Notification Toast Animation */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        .toast-enter { animation: slideIn 0.4s ease-out forwards; }
        .toast-exit { animation: slideOut 0.4s ease-in forwards; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 overflow-hidden font-sans">

    <!-- Notification Container -->
    <div id="toast-container" class="fixed top-24 right-5 z-[100] flex flex-col gap-2 pointer-events-none"></div>

    <!-- Fixed Header -->
    <header class="bg-white px-6 py-4 flex justify-between items-center shadow-sm z-50 relative">
        <div onclick="app.navigate('home')" class="flex items-center gap-2 cursor-pointer active:scale-95 transition-transform">
            <i class="fa-solid fa-house-circle-check text-brand-yellow text-2xl"></i>
            <h1 class="text-xl font-bold tracking-tight">Nest <span class="text-brand-yellow">Link</span></h1>
        </div>
        <div class="flex gap-4">
            <button class="text-gray-400"><i class="fa-regular fa-bell"></i></button>
            <div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center text-brand-yellow border border-yellow-200">
                <i onclick="app.navigate('profile')" class="fa-solid fa-user text-sm"></i>
            </div>
        </div>
    </header>

    <!-- Scrollable Content -->
    <main id="app-root" class="overflow-y-auto no-scrollbar">
        <!-- Content injected here -->
    </main>

    <!-- Navigation -->
    <nav class="fixed bottom-0 w-full bg-white h-20 border-t border-gray-100 flex justify-between items-center px-10 z-50">
        <button onclick="app.navigate('home')" id="nav-home" class="flex flex-col items-center gap-1 text-brand-yellow">
            <i class="fa-solid fa-home text-xl"></i>
            <span class="text-[10px] font-bold">HOME</span>
        </button>
        <div class="relative w-16">
            <div class="nav-center-container">
                <button onclick="app.navigate('add')" class="nav-center-btn">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>
        </div>
        <button onclick="app.navigate('profile')" id="nav-profile" class="flex flex-col items-center gap-1 text-gray-400">
            <i class="fa-solid fa-user-circle text-xl"></i>
            <span class="text-[10px] font-bold">PROFILE</span>
        </button>
    </nav>

    <script>
        const SHEET_ID = '10mJu780AVPJ5WahamWVGmLddEWrMy2BL-_CvK0A6Qco';
        const GVIZ_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

        // --- API Key for Image Upload (imgbb) ---
        // Replace with your key from https://api.imgbb.com/
        const IMAGE_API_KEY = '23e91f11d7a0da351aebf8cdb6d9c871'; 

        const app = {
            allData: [],
            filtered: [],
            currentView: 'home',
            searchQuery: '',
            category: 'All',
            heroInterval: null,

            init: async () => {
                await app.fetchData();
            },

            fetchData: async () => {
                try {
                    const res = await fetch(GVIZ_URL);
                    const text = await res.text();
                    const json = JSON.parse(text.substr(47).slice(0, -2));
                    const cols = json.table.cols.map(c => (c.label || '').toLowerCase());

                    app.allData = json.table.rows.map(row => {
                        const getVal = (keywords) => {
                            const i = cols.findIndex(c => keywords.some(k => c.includes(k)));
                            return (i > -1 && row.c[i]) ? (row.c[i].v || row.c[i].f || '') : '';
                        };

                        // Mapping logic for display (reading from sheet)
                        let typeRaw = getVal(['type']);
                        let type = 'Other';
                        
                        if (typeRaw.toLowerCase().includes('house')) type = 'House';
                        else if (typeRaw.toLowerCase().includes('hostel')) type = 'Hostel';
                        else if (typeRaw.toLowerCase().includes('hotel')) type = 'Hotel';
                        else if (typeRaw.toLowerCase().includes('land')) type = 'Land';

                        return {
                            title: getVal(['title', 'name', 'property']),
                            price: getVal(['price', 'cost']),
                            location: getVal(['location', 'address']),
                            description: getVal(['desc', 'about', 'detail']),
                            image1: getVal(['picture 1']),
                            image2: getVal(['picture 2']),
                            beds: getVal(['bed']) || 0,
                            baths: getVal(['bath']) || 0,
                            cars: getVal(['car', 'park']) || 0,
                            call: getVal(['call', 'phone', 'contact']),
                            whatsapp: getVal(['whats', 'app']),
                            status: getVal(['status']) || 'Sale',
                            type: type
                        };
                    });
                    app.applyFilters(false);
                } catch (e) {
                    console.error("Data Fetch Error:", e);
                }
            },

            processImg: (url) => {
                if (!url) return 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?auto=format&fit=crop&w=800&q=80';
                if (url.includes('drive.google.com')) {
                    const id = url.match(/[-\w]{25,}/);
                    return id ? `https://lh3.googleusercontent.com/d/${id[0]}=s1000` : url;
                }
                return url;
            },

            formatPrice: (p) => {
                if (!p) return 'GH₵ --';
                const clean = p.toString().replace(/[^0-9]/g, '');
                return `GH₵ ${Number(clean).toLocaleString()}`;
            },

            handleSearch: (val) => {
                app.searchQuery = val;
                app.applyFilters(true);
            },

            applyFilters: (isSearching = false) => {
                const q = app.searchQuery.toLowerCase();
                app.filtered = app.allData.filter(item => {
                    const matchSearch = item.title.toLowerCase().includes(q) || item.location.toLowerCase().includes(q);
                    const matchCat = app.category === 'All' || item.type === app.category;
                    return matchSearch && matchCat;
                });
                
                if (isSearching && app.currentView === 'home') {
                    app.renderListOnly();
                } else {
                    app.render();
                }
            },

            navigate: (view, id = null) => {
                app.currentView = view;
                const root = document.getElementById('app-root');
                if (root) root.scrollTo(0, 0);

                if (app.heroInterval) {
                    clearInterval(app.heroInterval);
                    app.heroInterval = null;
                }

                document.getElementById('nav-home').className = `flex flex-col items-center gap-1 ${view === 'home' ? 'text-brand-yellow' : 'text-gray-400'}`;
                document.getElementById('nav-profile').className = `flex flex-col items-center gap-1 ${view === 'profile' ? 'text-brand-yellow' : 'text-gray-400'}`;

                if (view === 'detail') app.renderDetail(id);
                else app.render();
            },

            // --- Geolocation Logic ---
            getCurrentLocation: () => {
                const btn = document.getElementById('location-btn');
                const originalContent = btn.innerHTML;
                const input = document.querySelector('input[name="locationLink"]');
                
                if (!navigator.geolocation) {
                    alert('Geolocation is not supported by your browser');
                    return;
                }

                btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
                btn.disabled = true;

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        // Create Google Maps Link
                        const mapLink = `https://www.google.com/maps?q=${lat},${lng}`;
                        
                        input.value = mapLink;
                        btn.innerHTML = '<i class="fa-solid fa-check text-green-600"></i>';
                        btn.disabled = false;
                        
                        // Revert icon after 2 seconds
                        setTimeout(() => {
                            btn.innerHTML = originalContent;
                        }, 2000);
                    },
                    (error) => {
                        alert('Unable to retrieve your location. Please check permissions.');
                        btn.innerHTML = originalContent;
                        btn.disabled = false;
                    }
                );
            },

            // --- Success Toast ---
            showSuccessToast: (message) => {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = 'toast-enter pointer-events-auto bg-white border-l-4 border-green-500 shadow-xl rounded-lg p-4 flex items-center gap-3 min-w-[280px]';
                toast.innerHTML = `
                    <div class="rounded-full bg-green-100 p-2 text-green-600">
                        <i class="fa-solid fa-check"></i>
                    </div>
                    <div>
                        <h4 class="font-bold text-sm text-gray-800">Message</h4>
                        <p class="text-xs text-gray-500">${message}</p>
                    </div>
                `;
                container.appendChild(toast);

                setTimeout(() => {
                    toast.classList.remove('toast-enter');
                    toast.classList.add('toast-exit');
                    setTimeout(() => toast.remove(), 400);
                }, 3000);
            },

            handleSignUp: (e) => {
                e.preventDefault();
                app.navigate('home');
                setTimeout(() => {
                    app.showSuccessToast('Account created successfully');
                }, 300);
            },

            uploadImageToHost: async (file) => {
                if (!file) return '';
                const formData = new FormData();
                formData.append('image', file);
                try {
                    // Using ImgBB API
                    const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMAGE_API_KEY}`, {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();
                    if (result.success || result.status === 200) {
                        return result.data.url;
                    } else {
                        console.error('Upload failed:', result);
                        return ''; 
                    }
                } catch (error) {
                    console.error('Error uploading:', error);
                    // Fallback for demo if no key
                    return 'https://images.unsplash.com/photo-1600596542815-2a4d9f8010d1?auto=format&fit=crop&w=800&q=80';
                }
            },

            // --- SUBMIT LISTING HANDLER ---
            handleSubmitListing: async (e) => {
                e.preventDefault();
                const btn = e.target.querySelector('button[type="submit"]');
                const originalText = btn.innerHTML;
                
                btn.disabled = true;
                btn.innerHTML = `<i class="fa-solid fa-circle-notch fa-spin"></i> Processing...`;

                try {
                    // 1. Get Files
                    const file1 = document.getElementById('file-upload-1').files[0];
                    const file2 = document.getElementById('file-upload-2').files[0];

                    if (!file1 || !file2) {
                        throw new Error("Please upload both images.");
                    }

                    // 2. Upload Images
                    btn.innerHTML = `<i class="fa-solid fa-cloud-arrow-up fa-bounce"></i> Uploading Data...`;
                    const img1Url = await app.uploadImageToHost(file1);
                    const img2Url = await app.uploadImageToHost(file2);

                    // 3. Prepare Data for Google Sheet 
                    // (Mapping to your specific columns: Name, Type, Status, Location, etc.)
                    const formData = new FormData(e.target);
                    const data = {
                        name: formData.get('name'),         // Column 1
                        type: formData.get('type'),         // Column 2
                        status: formData.get('status'),     // Column 3
                        location: formData.get('location'), // Column 4
                        bedrooms: formData.get('bedrooms'), // Column 5
                        bathrooms: formData.get('bathrooms'),// Column 6
                        carpark: formData.get('carpark'),   // Column 7
                        price: formData.get('price'),       // Column 8
                        picture1: img1Url,                  // Column 9
                        picture2: img2Url,                  // Column 10
                        description: formData.get('description'), // Column 11
                        locationLink: formData.get('locationLink'), // Column 12
                        call: formData.get('call'),         // Column 13
                        whatsapp: formData.get('whatsapp')  // Column 14
                    };

                    console.log("Submitting Data:", data);

                    // 4. Send to Google Apps Script
                    // Uncomment line below and add your URL
                    await fetch('https://script.google.com/macros/s/AKfycby1TLTyX42UvfgCB-D_ogYhGGTPqwm4v3TrrpXBUeZa7OlymyKIfTelNycOCkFBlBFXoQ/exec', { method: 'POST', body: JSON.stringify(data) });

                    // Simulating success delay
                    await new Promise(r => setTimeout(r, 1500));

                    app.navigate('home');
                    setTimeout(() => {
                        app.showSuccessToast('Listing added successfully');
                    }, 300);

                } catch (err) {
                    alert('Error: ' + err.message);
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            },

            renderListOnly: () => {
                const container = document.getElementById('listing-container');
                if (!container) return;
                container.innerHTML = app.generateListHTML();
            },

            generateListHTML: () => {
                if (app.filtered.length === 0) return `<p class="text-center text-gray-400 py-10">No items found.</p>`;
                return app.filtered.map((item) => `
                    <div onclick="app.navigate('detail', ${app.allData.indexOf(item)})" class="listing-card bg-white rounded-[2rem] overflow-hidden shadow-xl shadow-gray-200/50 cursor-pointer mb-8">
                        <div class="h-64 overflow-hidden relative">
                            <img src="${app.processImg(item.image1)}" class="listing-img w-full h-full object-cover">
                            <div class="absolute top-4 left-4 bg-white/95 backdrop-blur-sm px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-wider shadow-sm">
                                ${item.status}
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold text-lg leading-tight w-2/3">${item.title}</h3>
                                <span class="text-brand-yellow font-bold text-lg">${app.formatPrice(item.price)}</span>
                            </div>
                            <p class="text-gray-400 text-xs mb-6"><i class="fa-solid fa-location-dot text-brand-yellow"></i> ${item.location}</p>
                            <div class="flex justify-between pt-4 border-t border-gray-50">
                                <div class="flex gap-4">
                                    <div class="flex flex-col items-center"><i class="fa-solid fa-bed text-gray-300 text-sm mb-1"></i><span class="text-[10px] font-bold">${item.beds}</span></div>
                                    <div class="flex flex-col items-center"><i class="fa-solid fa-bath text-gray-300 text-sm mb-1"></i><span class="text-[10px] font-bold">${item.baths}</span></div>
                                    <div class="flex flex-col items-center"><i class="fa-solid fa-car text-gray-300 text-sm mb-1"></i><span class="text-[10px] font-bold">${item.cars}</span></div>
                                </div>
                                <button class="bg-gray-900 text-white text-[10px] font-bold px-4 py-2 rounded-lg uppercase tracking-tight">View Details</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            startHeroAutoScroll: () => {
                const scroller = document.getElementById('hero-scroller');
                if (!scroller) return;

                let index = 0;
                const imagesCount = 3;

                app.heroInterval = setInterval(() => {
                    index = (index + 1) % imagesCount;
                    scroller.scrollTo({
                        left: index * scroller.offsetWidth,
                        behavior: 'smooth'
                    });
                }, 4000);
            },

            render: () => {
                const root = document.getElementById('app-root');
                if (app.currentView === 'home') {
                    // --- HOME SECTION (UNTOUCHED) ---
                    const heroImages = [
                        'https://images.unsplash.com/photo-1613490493576-7fde63acd811?auto=format&fit=crop&w=1200&q=80',
                        'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=1200&q=80',
                        'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=1200&q=80'
                    ];

                    root.innerHTML = `
                        <div class="px-3 py-5">
                            <div class="relative h-40 w-full rounded-[1rem] overflow-hidden mb-5 shadow-l">
                                <div id="hero-scroller" class="flex h-full w-full overflow-x-auto snap-x snap-mandatory no-scrollbar scroll-smooth">
                                    ${heroImages.map(img => `
                                        <div class="min-w-full h-full snap-center relative">
                                            <img src="${img}" class="w-full h-full object-cover">
                                            <div class="hero-gradient absolute inset-0"></div>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="absolute inset-0 flex flex-col justify-end p-8 pointer-events-none">
                                    <h2 class="text-3xl font-bold text-white mb-1">Discover Homes</h2>
                                    <p class="text-white/80 text-xs uppercase tracking-widest font-semibold">Premium Real Estate Ghana</p>
                                </div>
                            </div>
                            <div class="space-y-6">
                                <div class="relative">
                                    <i class="fa-solid fa-search absolute left-4 top-5 text-yellow-300"></i>
                                    <input type="text" id="main-search" placeholder="Search by location or property..." 
                                        oninput="app.handleSearch(this.value)"
                                        value="${app.searchQuery}"
                                        class="w-full bg-white border border-gray-100 py-4 pl-12 pr-4 rounded-2xl shadow-sm focus:ring-2 focus:ring-yellow-400 transition outline-none">
                                </div>
                                <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2">
                                    ${['All', 'House', 'Hotel', 'Hostel', 'Land'].map(c => `
                                        <button onclick="app.category='${c}'; app.applyFilters()" 
                                            class="px-6 py-2.5 rounded-xl text-xs font-bold transition whitespace-nowrap shadow-sm
                                            ${app.category === c ? 'bg-brand-yellow text-white' : 'bg-white text-gray-500 border border-gray-100'}">
                                            ${c}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        <div id="listing-container" class="px-6 pb-24">
                            ${app.generateListHTML()}
                        </div>
                    `;
                    setTimeout(app.startHeroAutoScroll, 100);

                } else if (app.currentView === 'add') {
                    // --- UPDATED ADD LISTING SECTION ---
                    root.innerHTML = `
                        <div class="p-6 pb-24 bg-white min-h-full">
                            <h2 class="text-2xl font-bold mb-6">List Property</h2>
                            
                            <form onsubmit="app.handleSubmitListing(event)" class="space-y-6">
                                <!-- Name -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Name</label>
                                    <input type="text" name="name" required placeholder="e.g. Luxury Villa in Osu" 
                                        class="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl focus:border-brand-yellow focus:ring-1 focus:ring-brand-yellow outline-none transition">
                                </div>

                                <!-- Type & Status -->
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Type</label>
                                        <select name="type" class="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl outline-none">
                                            <option>House</option>
                                            <option>Hostel</option>
                                            <option>Hotel</option>
                                            <option>Land</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Status</label>
                                        <select name="status" class="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl outline-none">
                                            <option>Sale</option>
                                            <option>Rent</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Location (Text) -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Location (Address)</label>
                                    <div class="relative">
                                        <i class="fa-solid fa-location-dot absolute left-4 top-4 text-gray-400"></i>
                                        <input type="text" name="location" required placeholder="e.g. East Legon, Accra" 
                                            class="w-full bg-gray-50 border border-gray-200 p-4 pl-10 rounded-xl focus:border-brand-yellow outline-none transition">
                                    </div>
                                </div>

                                <!-- Location Link (With Geo Button) -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Location Link (Google Maps)</label>
                                    <div class="flex gap-2">
                                        <div class="relative flex-1">
                                            <i class="fa-solid fa-map-location-dot absolute left-4 top-4 text-gray-400"></i>
                                            <input type="text" name="locationLink" placeholder="Paste link or use button..." 
                                                class="w-full bg-gray-50 border border-gray-200 p-4 pl-10 rounded-xl focus:border-brand-yellow outline-none transition">
                                        </div>
                                        <button type="button" id="location-btn" onclick="app.getCurrentLocation()" 
                                            class="bg-blue-100 text-blue-600 px-4 rounded-xl border border-blue-200 hover:bg-blue-200 transition">
                                            <i class="fa-solid fa-location-crosshairs text-xl"></i>
                                        </button>
                                    </div>
                                    <p class="text-[10px] text-gray-400 mt-1 ml-1">Click the target icon to use your current GPS location.</p>
                                </div>

                                <!-- Specs: Beds, Baths, Car Park -->
                                <div class="grid grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Bedrooms</label>
                                        <input type="number" name="bedrooms" placeholder="0" class="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl text-center outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Bathrooms</label>
                                        <input type="number" name="bathrooms" placeholder="0" class="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl text-center outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Car Park</label>
                                        <input type="number" name="carpark" placeholder="0" class="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl text-center outline-none">
                                    </div>
                                </div>

                                <!-- Price -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Price (GH₵)</label>
                                    <input type="number" name="price" required placeholder="500000" 
                                        class="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl focus:border-brand-yellow outline-none transition">
                                </div>

                                <!-- Pictures -->
                                <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100">
                                    <h3 class="text-sm font-bold text-blue-900 mb-3"><i class="fa-solid fa-images mr-2"></i> Upload Pictures (2 Required)</h3>
                                    <div class="space-y-3">
                                        <div class="relative">
                                            <label class="text-[10px] uppercase font-bold text-blue-800 mb-1 block">Picture 1</label>
                                            <input type="file" id="file-upload-1" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-white file:text-blue-700 hover:file:bg-blue-100 cursor-pointer">
                                        </div>
                                        <div class="relative">
                                            <label class="text-[10px] uppercase font-bold text-blue-800 mb-1 block">Picture 2</label>
                                            <input type="file" id="file-upload-2" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-white file:text-blue-700 hover:file:bg-blue-100 cursor-pointer">
                                        </div>
                                    </div>
                                </div>

                                <!-- Description -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Description</label>
                                    <textarea name="description" rows="4" class="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl focus:border-brand-yellow outline-none resize-none"></textarea>
                                </div>

                                <!-- Contacts -->
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Call</label>
                                        <input type="tel" name="call" placeholder="024..." class="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">WhatsApp</label>
                                        <input type="tel" name="whatsapp" placeholder="23324..." class="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl outline-none">
                                    </div>
                                </div>

                                <button type="submit" class="w-full bg-brand-yellow text-brand-dark py-4 rounded-xl font-bold text-lg shadow-lg hover:brightness-105 transition-all">
                                    Submit Listing
                                </button>
                            </form>
                        </div>
                    `;
                } else if (app.currentView === 'profile') {
                    // --- SIGN UP / PROFILE SECTION ---
                    root.innerHTML = `
                        <div class="p-8 flex flex-col items-center justify-center min-h-[80vh]">
                            <div class="w-24 h-24 rounded-full bg-yellow-50 flex items-center justify-center mb-6 border-4 border-white shadow-lg">
                                <i class="fa-solid fa-user-plus text-4xl text-brand-yellow"></i>
                            </div>
                            
                            <h2 class="text-2xl font-bold mb-2">Create Account</h2>
                            <p class="text-gray-400 text-sm mb-8 text-center">Join Nest Link to manage your listings and favorites.</p>

                            <form onsubmit="app.handleSignUp(event)" class="w-full space-y-5">
                                <div class="relative">
                                    <i class="fa-regular fa-user absolute left-4 top-4 text-gray-400"></i>
                                    <input type="text" required placeholder="Full Name" 
                                        class="w-full bg-white border border-gray-200 p-4 pl-12 rounded-xl focus:border-brand-yellow focus:ring-1 focus:ring-brand-yellow outline-none transition">
                                </div>
                                <div class="relative">
                                    <i class="fa-regular fa-envelope absolute left-4 top-4 text-gray-400"></i>
                                    <input type="email" required placeholder="Email Address" 
                                        class="w-full bg-white border border-gray-200 p-4 pl-12 rounded-xl focus:border-brand-yellow focus:ring-1 focus:ring-brand-yellow outline-none transition">
                                </div>
                                <div class="relative">
                                    <i class="fa-solid fa-lock absolute left-4 top-4 text-gray-400"></i>
                                    <input type="password" required placeholder="Password" 
                                        class="w-full bg-white border border-gray-200 p-4 pl-12 rounded-xl focus:border-brand-yellow focus:ring-1 focus:ring-brand-yellow outline-none transition">
                                </div>

                                <button type="submit" class="w-full bg-gray-900 text-white py-4 rounded-xl font-bold text-lg shadow-xl hover:bg-gray-800 transition-all mt-4">
                                    Sign Up
                                </button>
                            </form>
                        </div>
                    `;
                }
            },

            renderDetail: (idx) => {
                // --- DETAIL SECTION (UNTOUCHED as requested) ---
                const item = app.allData[idx];
                const related = app.allData.filter((r, i) => i !== idx && r.type === item.type).slice(0, 4);
                const root = document.getElementById('app-root');
                const images = [item.image1, item.image2].filter(img => img);

                root.innerHTML = `
                    <div class="bg-white min-h-full">
                        <div class="relative h-[45vh] bg-gray-100 overflow-hidden">
                            <div id="gallery-scroller" class="flex h-full w-full overflow-x-auto snap-x snap-mandatory no-scrollbar" onscroll="app.updateGalleryDots(event)">
                                ${images.map(img => `<div class="min-w-full h-full snap-center"><img src="${app.processImg(img)}" class="w-full h-full object-cover"></div>`).join('')}
                            </div>
                            <button onclick="app.navigate('home')" class="absolute top-6 left-6 w-10 h-10 bg-white/90 backdrop-blur rounded-full flex items-center justify-center shadow-lg z-20">
                                <i class="fa-solid fa-chevron-left text-gray-800"></i>
                            </button>
                            <div class="absolute bottom-6 left-6 bg-brand-yellow text-white px-5 py-2 rounded-full text-xs font-bold uppercase tracking-widest shadow-lg z-20">
                                ${item.status}
                            </div>
                            ${images.length > 1 ? `<div class="absolute bottom-6 right-6 flex gap-2 z-20">${images.map((_, i) => `<div class="gallery-dot h-1.5 w-1.5 rounded-full bg-white/50 transition-all duration-300 ${i === 0 ? 'active' : ''}"></div>`).join('')}</div>` : ''}
                        </div>

                        <div class="px-6 -mt-10 relative bg-white rounded-t-[3rem] pt-10 pb-40">
                            <div class="flex justify-between items-start mb-2">
                                <h1 class="text-2xl font-bold w-2/3 leading-tight">${item.title}</h1>
                                <span class="text-brand-yellow font-bold text-xl">${app.formatPrice(item.price)}</span>
                            </div>
                            <p class="text-gray-400 text-sm mb-8"><i class="fa-solid fa-location-dot text-brand-yellow"></i> ${item.location}</p>

                            <div class="grid grid-cols-3 bg-gray-50 rounded-3xl p-6 mb-8 text-center border border-gray-100">
                                <div><div class="text-brand-yellow font-bold text-lg">${item.beds}</div><div class="text-[10px] text-gray-400 uppercase font-bold tracking-tighter">Bedrooms</div></div>
                                <div class="border-x border-gray-200"><div class="text-brand-yellow font-bold text-lg">${item.baths}</div><div class="text-[10px] text-gray-400 uppercase font-bold tracking-tighter">Bathrooms</div></div>
                                <div><div class="text-brand-yellow font-bold text-lg">${item.cars}</div><div class="text-[10px] text-gray-400 uppercase font-bold tracking-tighter">Parking</div></div>
                            </div>

                            <div class="grid grid-cols-2 gap-4 mb-8">
                                <div class="flex items-center gap-3 bg-gray-50 p-3 rounded-2xl">
                                    <i class="fa-solid fa-tag text-brand-yellow"></i>
                                    <div><p class="text-[10px] text-gray-400 font-bold uppercase">Property Type</p><p class="text-xs font-bold">${item.type}</p></div>
                                </div>
                                <div class="flex items-center gap-3 bg-gray-50 p-3 rounded-2xl">
                                    <i class="fa-solid fa-circle-check text-brand-verified"></i>
                                    <div><p class="text-[10px] text-gray-400 font-bold uppercase">Status</p><p class="text-xs font-bold text-brand-verified">Verified</p></div>
                                </div>
                            </div>

                            <h3 class="font-bold mb-3">Description</h3>
                            <p class="text-gray-500 text-sm leading-relaxed mb-8">${item.description || "No description provided."}</p>

                            <h3 class="font-bold mb-4">Map Location</h3>
                            <div class="h-64 rounded-3xl overflow-hidden mb-12 border border-gray-200">
                                <iframe width="100%" height="100%" frameborder="0" src="https://maps.google.com/maps?q=${encodeURIComponent(item.location)}&t=&z=14&ie=UTF8&iwloc=&output=embed"></iframe>
                            </div>
                            
                            ${related.length > 0 ? `
                            <div class="mt-12">
                                <h3 class="font-bold text-lg mb-6">Similar ${item.type}s</h3>
                                <div class="grid grid-cols-2 gap-4">
                                    ${related.map(r => `
                                        <div onclick="app.navigate('detail', ${app.allData.indexOf(r)})" class="bg-white rounded-3xl overflow-hidden border border-gray-100 shadow-sm flex flex-col h-full">
                                            <div class="h-32 bg-gray-200 relative">
                                                <img src="${app.processImg(r.image1)}" class="w-full h-full object-cover">
                                                <div class="absolute top-2 right-2 bg-white/95 backdrop-blur px-2 py-0.5 rounded-full text-[8px] font-bold uppercase shadow-sm">
                                                    ${r.status}
                                                </div>
                                            </div>
                                            <div class="p-3 flex flex-col justify-between flex-1">
                                                <div>
                                                    <p class="text-[10px] font-bold truncate mb-0.5">${r.title}</p>
                                                    <p class="text-[9px] text-gray-400 truncate mb-2">${r.location}</p>
                                                </div>
                                                <p class="text-brand-yellow font-bold text-xs">${app.formatPrice(r.price)}</p>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>` : ''}
                        </div>

                        <!-- Sticky Bottom Bar -->
                        <div class="fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur-md border-t px-6 py-6 flex gap-4 z-[60] pb-8">
                            <a href="tel:${item.call}" class="flex-1 bg-gray-100 text-gray-900 font-bold py-4 rounded-2xl text-center shadow-sm">
                                <i class="fa-solid fa-phone mr-2"></i> CALL
                            </a>
                            <a href="https://wa.me/${item.whatsapp}?text=Hello , I am interested in your ${item.type} I saw on Nest Link .Name:${item.title} ,Price: GHS${item.price} .${item.image1}" class="flex-1 bg-brand-yellow text-white font-bold py-4 rounded-2xl text-center shadow-lg shadow-yellow-400/30">
                                <i class="fa-brands fa-whatsapp mr-2"></i> WHATSAPP
                            </a>
                        </div>
                    </div>
                `;
            },

            updateGalleryDots: (e) => {
                const scroller = e.target;
                const index = Math.round(scroller.scrollLeft / scroller.offsetWidth);
                const dots = document.querySelectorAll('.gallery-dot');
                dots.forEach((dot, i) => {
                    if (i === index) dot.classList.add('active');
                    else dot.classList.remove('active');
                });
            }
        };

        app.init();
    </script>
</body>
</html>
